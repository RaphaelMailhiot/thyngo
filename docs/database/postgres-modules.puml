@startuml

title ThynGo Modules - PostgreSQL Database Schema

database "thyngo" as thyngo {
}

entity "media" as media <<table>> {
  id : BIGSERIAL «PK»
  slug : TEXT «unique»
  title : TEXT
  type : TEXT «movie, series, other»
  created_at : TIMESTAMPTZ
  updated_at : TIMESTAMPTZ
}

entity "posts" as posts <<table>> {
  id : BIGSERIAL «PK»
  slug : TEXT «unique»
  title : TEXT
  created_at : TIMESTAMPTZ
  updated_at : TIMESTAMPTZ
}

entity "projects" as projects <<table>> {
  id : BIGSERIAL «PK»
  slug : TEXT «unique»
  title : TEXT
  created_at : TIMESTAMPTZ
  updated_at : TIMESTAMPTZ
}

entity "resumes" as resumes <<table>> {
  id : BIGSERIAL «PK»
  user_id : BIGINT
  name : TEXT
  email : TEXT
  phone : TEXT
  job : TEXT
  github : TEXT
  linkedin : TEXT
  website : TEXT
  created_at : TIMESTAMPTZ
  updated_at : TIMESTAMPTZ
}

entity "users" as users <<table>> {
  id : BIGSERIAL «PK»
  username : TEXT «unique»
  email : TEXT «unique»
  password_hash : TEXT
  role : TEXT
  created_at : TIMESTAMPTZ
  updated_at : TIMESTAMPTZ
}

entity "contents" as contents <<table>> {
  id : BIGSERIAL «PK»
  parent_table : TEXT «posts, projects»
  parent_id : BIGINT
  ord : INT
  type : TEXT «image,title,text,code,custom»
  block_id : BIGINT «FK -> blocks.id»
  created_at : TIMESTAMPTZ
  updated_at : TIMESTAMPTZ
}

entity "blocks" as blocks <<table>> {
  id : BIGSERIAL «PK»
  type : TEXT «image,title,text,code,custom»
  created_at : TIMESTAMPTZ
  updated_at : TIMESTAMPTZ
}

entity "image_blocks" as images <<table>> {
  id : BIGSERIAL «PK»
  block_id : BIGINT
  url : TEXT
  title : TEXT
  created_at : TIMESTAMPTZ
  updated_at : TIMESTAMPTZ
}

entity "title_blocks" as titles <<table>> {
  id : BIGSERIAL «PK»
  block_id : BIGINT
  level : SMALLINT
  content : TEXT
  created_at : TIMESTAMPTZ
  updated_at : TIMESTAMPTZ
}

entity "text_blocks" as texts <<table>> {
  id : BIGSERIAL «PK»
  block_id : BIGINT
  content : TEXT
  created_at : TIMESTAMPTZ
  updated_at : TIMESTAMPTZ
}

entity "code_blocks" as codes <<table>> {
  id : BIGSERIAL «PK»
  block_id : BIGINT
  language : TEXT
  content : TEXT
  created_at : TIMESTAMPTZ
  updated_at : TIMESTAMPTZ
}

entity "custom_blocks" as customs <<table>> {
  id : BIGSERIAL «PK»
  block_id : BIGINT
  payload : JSONB
  created_at : TIMESTAMPTZ
  updated_at : TIMESTAMPTZ
}

entity "experiences" as experiences <<table>> {
  id : BIGSERIAL «PK»
  resume_id : BIGINT
  job_title : TEXT
  job_type : TEXT
  company : TEXT
  started_date : DATE
  ended_date : DATE
  location : TEXT
  location_type : TEXT
  description : TEXT
  created_at : TIMESTAMPTZ
  updated_at : TIMESTAMPTZ
}

entity "educations" as educations <<table>> {
  id : BIGSERIAL «PK»
  resume_id : BIGINT
  school : TEXT
  diploma : TEXT
  study_field : TEXT
  started_date : DATE
  ended_date : DATE
  description : TEXT
  created_at : TIMESTAMPTZ
  updated_at : TIMESTAMPTZ
}

entity "skills" as skills <<table>> {
  id : BIGSERIAL «PK»
  resume_id : BIGINT
  title : TEXT
  description : TEXT
  created_at : TIMESTAMPTZ
  updated_at : TIMESTAMPTZ
}

' Modules tables
thyngo --> media
thyngo --> projects
thyngo --> posts
thyngo --> resumes
thyngo --> users

' Contents / Blocks relations
posts "1" -- "0..*" contents : has_contents_blocks
projects "1" -- "0..*" contents : has_contents_blocks
contents "1" -- "1" blocks : references_block
blocks "1" -- "0..*" contents : used_by_contents

' Blocks to specific block tables
blocks "1" -- "0..*" images : has_image_variant
blocks "1" -- "0..*" titles : has_title_variant
blocks "1" -- "0..*" texts : has_text_variant
blocks "1" -- "0..*" codes : has_code_variant
blocks "1" -- "0..*" customs : has_custom_variant

' Resume related tables
resumes "1" -- "0..*" experiences
resumes "1" -- "0..*" educations
resumes "1" -- "0..*" skills

' Foreign key hints (diagrammatic)
users ||--o{ resumes : owns
resumes ||--o{ experiences : has
resumes ||--o{ educations : has
resumes ||--o{ skills : has

@enduml
